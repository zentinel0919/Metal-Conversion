<!DOCTYPE html>
<html>  
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Goldman&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style2.css">
    <title>Precious Metals Price Converter</title>
</head>
<header>
    <nav class="navbar">
        <div class="container">
            <a href="/" class="navbar-brand">Precious Metals Price Converter</a>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav" id="nav-links">
                    <li class="nav-item">
                        <a href="#" class="nav-link" id="login-btn">Login</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" id="register-btn">Register</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<body>

<!-- Login Modal -->
<div id="login-modal" class="modal">
    <div class="modal-content">
        <span class="close" id="login-close">&times;</span>
        <h2>Login</h2>
        <form id="login-form">
            <label for="login-username">Username:</label>
            <input type="text" id="login-username" name="username" required>
            <label for="login-password">Password:</label>
            <input type="password" id="login-password" name="password" required>
            <button type="submit">Login</button>
        </form>
    </div>
</div>

<div id="register-modal" class="modal">
    <div class="modal-content">
        <span class="close" id="register-close">&times;</span>
        <h2>Register</h2>
        <form id="register-form">
            <label for="register-username">Username:</label>
            <input type="text" id="register-username" name="username" required>
            <label for="register-password">Password:</label>
            <input type="password" id="register-password" name="password" required>
            <button type="submit">Register</button>
        </form>
    </div>
</div>
  
<main>
<div class="section1">
    <h1>Metals Price Converter</h1>
    <form id="price-form">
        <label for="metal">Metal:</label>
        <select id="metal" name="metal">
            <option value="XAU">Gold</option>
            <option value="XAG">Silver</option>
            <option value="XPT">Platinum</option>
            <option value="XPD">Palladium</option>
        </select>
        <label for="amount">Amount:</label>
        <input type="number" id="amount" name="amount" required>
        <label for="currency">Currency:</label>
        <select id="currency" name="currency">
            <option value="USD">USD</option>
            <option value="AUD">AUD</option>
            <option value="GBP">GBP</option>
            <option value="EUR">EUR</option>
            <option value="CHF">CHF</option>
            <option value="CAD">CAD</option>
            <option value="JPY">JPY</option>
            <option value="KRW">KRW</option>
            <option value="INR">INR</option>
            <option value="CNY">CNY</option>
            <option value="ZAR">ZAR</option>
            <option value="THB">THB</option>
            <option value="SGD">SGD</option>
            <option value="BTC">BTC</option>
            <option value="HKD">HKD</option>
            <option value="CZK">CZK</option>
            <option value="RUB">RUB</option>
            <option value="PLN">PLN</option>
            <option value="MYR">MYR</option>
            <option value="AED">AED</option>
            <option value="KWD">KWD</option>
            <option value="EGP">EGP</option>
            <option value="OMR">OMR</option>
            <option value="SAR">SAR</option>
            <option value="MXN">MXN</option>
            <option value="JOD">JOD</option>
            <option value="XAG">XAG</option>
        </select>
        <button type="submit">Convert</button>
    </form>
    <div id="result"></div>
</div>
<div class="section2">
    <h1>Metal Information</h1>
    <div class="metal-info" id="XAU-info">
        <img src="/static/gold.png" alt="Gold">
        <p>Gold is a chemical element with the symbol Au and the atomic number 79. In its pure form, it is a bright, slightly orange-yellow, dense, soft, malleable, and ductile metal. Chemically, gold is a transition metal, a group 11 element, and one of the noble metals. It is one of the least reactive chemical elements, being the second-lowest in the reactivity series. It is solid under standard conditions.</p>
    </div>
    <div class="metal-info" id="XAG-info">
        <img src="/static/silver.png" alt="Silver">
        <p>Silver is a chemical element; it has symbol Ag and atomic number 47. A soft, white, lustrous transition metal, it exhibits the highest electrical conductivity, thermal conductivity, and reflectivity of any metal. The metal is found in the Earth's crust in the pure, free elemental form, as an alloy with gold and other metals, and in minerals such as argentite and chlorargyrite. Most silver is produced as a byproduct of copper, gold, lead, and zinc refining.</p>
    </div>
    <div class="metal-info" id="XPT-info">
        <img src="/static/platinum.png" alt="Platinum">
        <p>Platinum is a chemical element; it has symbol Pt and atomic number 78. It is a dense, malleable, ductile, highly unreactive, precious, silverish-white transition metal. Its name originates from Spanish platina, a diminutive of plata "silver".</p>
    </div>
    <div class="metal-info" id="XPD-info">
        <img src="/static/palladium.png" alt="Palladium">
        <p>Palladium is a chemical element; it has symbol Pd and atomic number 46. It is a rare and lustrous silvery-white metal discovered in 1802 by the English chemist William Hyde Wollaston. He named it after the asteroid Pallas, which was itself named after the epithet of the Greek goddess Athena, acquired by her when she slew Pallas. Palladium, platinum, rhodium, ruthenium, iridium and osmium form a group of elements referred to as the platinum group metals.</p>
    </div>
</div>
</main>
<div class="section3" id="section3" style="display:none;">
    <h1>Historical Prices</h1>
    <div class="section3-grid">
    <form id="historical-form">
        <label for="historical-metal">Metal:</label>
        <select id="historical-metal" name="metal">
            <option value="XAU">Gold</option>
            <option value="XAG">Silver</option>
            <option value="XPT">Platinum</option>
            <option value="XPD">Palladium</option>
        </select>
        <label for="amount">Number of Last Conversions:</label>
        <input type="number" id="amount" name="amount" value="1" min="1" required>
        <button type="submit">Get Last Conversions & Charts</button>
    </form>
    <table id="historical-result">
        <thead>
            <tr>
                <th>Date</th>
                <th>Total Price</th>
                <th>Currency</th>
                <th>Quantity</th>
                <th>Price per piece</th>
            </tr>
        </thead>
        <tbody id="historical-data">
        </tbody>
    </table>
</div>
<div id="charts-container" class="chart-row"></div>
</div>
<script>
    // Prevent form submission and handle conversion
    document.getElementById('price-form').addEventListener('submit', async (e) => {
        e.preventDefault(); // Prevent default form submission
        const formData = new FormData(e.target);
        const metal = formData.get('metal');
        const amount = formData.get('amount');
        const currency = formData.get('currency');
        const response = await fetch(`/convert/${metal}/${amount}?currency=${currency}`);
        const data = await response.json();
        document.getElementById('result').innerText = `Converted Price: ${data.price} ${currency}`;
    });

    // Display relevant metal information when a metal is selected
    const metalSelect = document.getElementById('metal');
    metalSelect.addEventListener('change', (e) => {
        const selectedMetal = e.target.value;
        const metalInfo = document.getElementById(`${selectedMetal}-info`);
        document.querySelectorAll('.metal-info').forEach(info => info.style.display = 'none');
        metalInfo.style.display = 'block';
    });

    
    const loginBtn = document.getElementById('login-btn');
    const loginModal = document.getElementById('login-modal');
    const loginClose = document.getElementById('login-close');

    loginBtn.onclick = function() {
        loginModal.style.display = "block";
    }

    loginClose.onclick = function() {
        loginModal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == loginModal) {
            loginModal.style.display = "none";
        }
    }

    const registerBtn = document.getElementById('register-btn');
    const registerModal = document.getElementById('register-modal');
    const registerClose = document.getElementById('register-close');

    registerBtn.onclick = function() {
        registerModal.style.display = "block";
    }

    registerClose.onclick = function() {
        registerModal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == registerModal) {
            registerModal.style.display = "none";
        }
    }

    // Handle form submissions
    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const response = await fetch('/login', {
            method: 'POST',
            body: formData,
        });
        const result = await response.json();
        if (response.ok) {
            location.reload();
            alert(result.message);
            localStorage.setItem('loggedIn', 'true'); // Example using localStorage
            document.getElementById('login-modal').style.display = "none";
            updateNavbar(); // Update navbar after login
            document.getElementById('section3').style.display = "block";
        } else {
            alert(result.detail);
        }
    });

    document.getElementById('register-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const response = await fetch('/register', {
            method: 'POST',
            body: formData,
        });
        const result = await response.json();
        if (response.ok) {
            alert(result.message);
            document.getElementById('register-modal').style.display = "none";
            location.reload();
        } else {
            alert(result.detail);
        }
    });

    document.getElementById('historical-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const metal = formData.get('metal');
    const amount = formData.get('amount');

    // Fetch last conversions
    const response = await fetch(`/last_conversions/${metal}?amount=${amount}`);
    if (response.status === 404) {
        alert("No conversions found for the selected metal.");
        return; // Exit the function early if no conversions found
    }
    
    const data = await response.json();

    // Clear previous historical data
    const historicalDataElement = document.getElementById('historical-data');
    historicalDataElement.innerHTML = '';

    // Check if data array is empty
    if (data.length === 0) {
        alert("No conversions found for the selected metal.");
        return; // Exit the function early if data array is empty
    }

    // Display historical prices in table format
    data.forEach(entry => {
        // Check if date is valid and price is defined
        const date = new Date(entry.date);
        const price = entry.total_price ? entry.total_price.toFixed(2) : "N/A";
        const currency = entry.currency ? entry.currency : "N/A";
        const quantity = entry.amount ? entry.amount.toFixed(2) : "N/A";
        const pricePerPiece = entry.price_per_piece ? entry.price_per_piece.toFixed(2) : "N/A";

        const row = document.createElement('tr');
        row.innerHTML = `<td>${date.toLocaleDateString()}</td><td>${price}</td><td>${currency}</td><td>${quantity}</td><td>${pricePerPiece}</td>`;
        historicalDataElement.appendChild(row);
    });

    document.getElementById('section3').style.display = 'block';
        const chartsContainer = document.getElementById('charts-container');
        chartsContainer.innerHTML = ''; // Clear existing charts

        // Add specific charts based on the selected metal
        if (metal === 'XAU') {
            chartsContainer.innerHTML = '<iframe style="background: #2c3f41;border: none;border-radius: 2px;box-shadow: 0 2px 10px 0 rgba(70, 76, 79, .2);" width="700" height="480" src="https://charts.mongodb.com/charts-project-0-prufi/embed/charts?id=66489c00-ec19-471e-8d97-17ad98af6247&maxDataAge=3600&theme=dark&autoRefresh=true"></iframe> <iframe style="background: #2c3f41;border: none;border-radius: 2px;box-shadow: 0 2px 10px 0 rgba(70, 76, 79, .2);" width="600" height="480" src="https://charts.mongodb.com/charts-project-0-prufi/embed/charts?id=66489e42-bdc1-4dbd-8ce3-ad1657634170&maxDataAge=3600&theme=dark&autoRefresh=true"></iframe>';
        } else if (metal === 'XAG') {
            chartsContainer.innerHTML = '<iframe style="background: #2c3f41;border: none;border-radius: 2px;box-shadow: 0 2px 10px 0 rgba(70, 76, 79, .2);" width="700" height="480" src="https://charts.mongodb.com/charts-project-0-prufi/embed/charts?id=8bb67cc8-9b39-44af-b64b-246f357ed06d&maxDataAge=3600&theme=dark&autoRefresh=true"></iframe> <iframe style="background: #2c3f41;border: none;border-radius: 2px;box-shadow: 0 2px 10px 0 rgba(70, 76, 79, .2);" width="600" height="480" src="https://charts.mongodb.com/charts-project-0-prufi/embed/charts?id=22f0dcd2-fa09-4f9b-a122-3d401b6a77a7&maxDataAge=3600&theme=dark&autoRefresh=true"></iframe>';
        } else if (metal === 'XPT') {
            chartsContainer.innerHTML = '<iframe style="background: #2c3f41;border: none;border-radius: 2px;box-shadow: 0 2px 10px 0 rgba(70, 76, 79, .2);" width="700" height="480" src="https://charts.mongodb.com/charts-project-0-prufi/embed/charts?id=52cb6d2f-012e-4d65-b352-f840defbbe8d&maxDataAge=3600&theme=dark&autoRefresh=true"></iframe> <iframe style="background: #2c3f41;border: none;border-radius: 2px;box-shadow: 0 2px 10px 0 rgba(70, 76, 79, .2);" width="600" height="480" src="https://charts.mongodb.com/charts-project-0-prufi/embed/charts?id=e81cf87f-21e2-437d-a8db-d11c0767761f&maxDataAge=3600&theme=dark&autoRefresh=true"></iframe>';
        } else if (metal === 'XPD') {
            chartsContainer.innerHTML = '<iframe style="background: #2c3f41;border: none;border-radius: 2px;box-shadow: 0 2px 10px 0 rgba(70, 76, 79, .2);" width="700" height="480" src="https://charts.mongodb.com/charts-project-0-prufi/embed/charts?id=da537f26-8ac2-4f81-be8c-fed0f547b32c&maxDataAge=3600&theme=dark&autoRefresh=true"></iframe> <iframe style="background: #2c3f41;border: none;border-radius: 2px;box-shadow: 0 2px 10px 0 rgba(70, 76, 79, .2);" width="600" height="480" src="https://charts.mongodb.com/charts-project-0-prufi/embed/charts?id=4adf520e-ec66-40b2-8afe-47c5ca86532b&maxDataAge=3600&theme=dark&autoRefresh=true"></iframe>';
        }
    
});
    


    document.addEventListener('DOMContentLoaded', () => {
        function isLoggedIn() {
            return localStorage.getItem('loggedIn') === 'true';
        }

        function updateNavbar() {
            const navLinks = document.getElementById('nav-links');
            navLinks.innerHTML = ''; // Clear existing links

            if (isLoggedIn()) {
                const logoutItem = document.createElement('li');
                logoutItem.className = 'nav-item';
                const logoutLink = document.createElement('a');
                logoutLink.href = '#';
                logoutLink.className = 'nav-link';
                logoutLink.id = 'logout-btn';
                logoutLink.textContent = 'Logout';
                logoutItem.appendChild(logoutLink);
                navLinks.appendChild(logoutItem);
                document.getElementById('section3').style.display = "block";

                logoutLink.addEventListener('click', () => {
                    localStorage.setItem('loggedIn', 'false');
                    alert('Logged out successfully');
                    updateNavbar(); // Update navbar after logout
                    document.getElementById('section3').style.display = "none";
                });
            } else {
                const loginItem = document.createElement('li');
                loginItem.className = 'nav-item';
                const loginLink = document.createElement('a');
                loginLink.href = '#';
                loginLink.className = 'nav-link';
                loginLink.id = 'login-btn';
                loginLink.textContent = 'Login';
                loginItem.appendChild(loginLink);

                const registerItem = document.createElement('li');
                registerItem.className = 'nav-item';
                const registerLink = document.createElement('a');
                registerLink.href = '#';
                registerLink.className = 'nav-link';
                registerLink.id = 'register-btn';
                registerLink.textContent = 'Register';
                registerItem.appendChild(registerLink);

                navLinks.appendChild(loginItem);
                navLinks.appendChild(registerItem);

                loginLink.onclick = function () {
                    document.getElementById('login-modal').style.display = "block";
                };

                registerLink.onclick = function () {
                    document.getElementById('register-modal').style.display = "block";
                };
            }
        }

        // Initial call to set up the navbar
        updateNavbar();
        });
    // Initialize the first metal information to be displayed
    document.getElementById('XAU-info').style.display = 'block';


</script>

</body>
</html>